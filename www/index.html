<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ApicBI</title>
  <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="style/main.css">
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>
<body>
  <div id="app-mount" class="container">

    <table>
      <thead>
        <!--<th>ID</th>-->
        <th>User name</th>
        <th>Remote number</th>
        <th>Workgroup</th>
        <th>State</th>
        <th>Call type</th>
        <th>Start date</th>
        <!--<th>Reference date</th>-->
        <th>End date</th>
        <th>Duration (seconds)</th>
        <th>Date queued</th>
        <th>Date connected</th>
        <th>Time queued</th>
        <th>Calc. time queued</th>
        <!--<th>Is abandoned</th>-->
        <!--<th>Is completed</th>-->
      </thead>
      <tbody>
        <tr v-for="interaction in interactions | orderBy 'queueDate'" :class="{ 'available': interaction.isCompleted }">
          <!--<td>{{ interaction.id }}</td>-->
          <td>{{ interaction.user.name || interaction.userName }}</td>
          <td>{{ interaction.remoteAddress }}</td>
          <td>{{ interaction.workgroup }}</td>
          <td>{{ interaction.state }}</td>
          <td>{{ interaction.callType + ' (' + (interaction.callDirection || 'missing') + ')' }}</td>
          <td>{{ interaction.startDate | date 'HH:mm:ss' }}</td>
          <!--<td>{{ interaction.referenceDate | date 'HH:mm:ss' }}</td>-->
          <td>{{ interaction.endDate | date 'HH:mm:ss' }}</td>
          <td>{{ interaction.duration > 0 ? formatTimer(interaction.duration) : 'pending' }}</td>
          <td>{{ interaction.queueDate | date 'YYYY-MM-DD HH:mm:ss' }}</td>
          <td>{{ interaction.connectedDate | date 'YYYY-MM-DD HH:mm:ss' }}</td>
          <td>{{ interaction.queueTime > 0 ? formatTimer(interaction.queueTime) : (!!interaction.endDate ? 'abandoned call' : 'in queue') }}</td>
          <td>{{ interaction.__queueTime > 0 ? formatTimer(interaction.__queueTime) : formatTimer(interaction._queueTime) }}</td>
          <!--<td>{{ !!interaction.isAbandoned ? interaction.isAbandoned : false }}</td>-->
          <!--<td>{{ !!interaction.isCompleted ? interaction.isCompleted : false }}</td>-->
        </tr>
      </tbody>
    </table>

    <h1>Daily queue info</h1>

    <table>
      <thead>
        <th>Workgroup</th>
        <th>Queue length</th>
        <th>Queue time</th>
        <th>Completed calls</th>
        <th>Abandoned calls</th>
        <th>Abandon rate</th>
      </thead>
      <tbody>
        <tr v-for="workgroup in ['csa', 'partnerService']">
          <td>{{ workgroup === 'csa' ? 'CSA' : 'Partner Service' }}</td>
          <td>{{ queueInfo[workgroup].queueLength }}</td>
          <td>{{ formatTimer(queueInfo[workgroup].queueTime) }}</td>
          <td>{{ queueInfo[workgroup].completedLength }}</td>
          <td>{{ queueInfo[workgroup].abandonedLength }}</td>
          <td>{{ queueInfo[workgroup].abandonRate + ' %' }}</td>
        </tr>
      </tbody>
    </table>

<!--
    <h1>Current queue time is {{ formatTimer(queueInfo.queueTime) }} ({{ queueInfo.queueLength }} calls in queue)</h1>
    <h1>CSA queue time is {{ formatTimer(queueInfo.csa.queueTime) }} ({{ queueInfo.csa.queueLength }} calls in queue)</h1>
    <h1>Partner Service queue time is {{ formatTimer(queueInfo.partnerService.queueTime) }} ({{ queueInfo.partnerService.queueLength }} calls in queue)</h1>

    <h1>Number of abandoned calls, CSA: {{ queueInfo.csa.abandonedLength }}, Partner Service: {{ queueInfo.partnerService.abandonedLength }}</h1>
    <h1>Number of completed calls, CSA: {{ queueInfo.csa.completedLength }}, Partner Service: {{ queueInfo.partnerService.completedLength }}</h1>
    <h1>Abandon rate is {{ queueInfo.abandonRate }} %</h1>

    <h1>Current time: {{ formatTimer(currentTime) }}</h1>-->

    <h1>{{ _availableUsers.length }} available agents</h1>

    <table>
      <thead>
        <th colspan="4">User name</th>
        <th colspan="4">Status</th>
        <th colspan="2">On phone</th>
        <th colspan="2">Logged in</th>
        <th colspan="3">Workgroups</th>
        <th colspan="4">Last change</th>
      </thead>
      <tbody>
        <tr v-for="user in users | orderBy 'lastLocalChange' -1" :class="{ 'available': isAvailable(user) }">
          <td colspan="4">{{ user.name }}</td>
          <td colspan="4">{{ user.statusName }}</td>
          <td colspan="2">{{ user.onPhone }}</td>
          <td colspan="2">{{ user.loggedIn }}</td>
          <td colspan="3">{{ getWorkgroups(user) }}</td>
          <td colspan="4">{{ user.lastLocalChange | date 'HH:mm:ss' }}</td>
        </tr>
      </tbody>
    </table>
  </div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.26/vue.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/0.9.3/vue-resource.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.14.1/lodash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment.min.js"></script>
  <script src="scripts/main.js"></script>
</body>
</html>